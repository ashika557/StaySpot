{% load i18n static %}
{% if result_hidden_fields %}
<div class="hiddenfields">
    {% for item in result_hidden_fields %}{{ item }}{% endfor %}
</div>
{% endif %}

{% if results %}
<div class="results">
    <table id="result_list" style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                {% for header in result_headers %}
                <th scope="col" {{ header.class_attrib }}
                    style="padding: 16px 24px; text-align: left; background: #F8FAFC; border-bottom: 1px solid #E2E8F0; color: #64748B; font-size: 12px; font-weight: 700; text-transform: uppercase;">
                    <div class="text">{{ header.label|capfirst }}</div>
                </th>{% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for result in results %}
            <tr style="border-bottom: 1px solid #F1F5F9;">
                {% for item in result %}
                <td style="padding: 16px 24px; vertical-align: middle;">{{ item }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<style>
    .role-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 800;
        text-transform: capitalize;
        border-width: 1px;
        border-style: solid;
    }

    .role-owner {
        background: #F5F3FF;
        color: #7C3AED;
        border-color: #DDD6FE;
    }

    .role-tenant {
        background: #EFF6FF;
        color: #2563EB;
        border-color: #BFDBFE;
    }

    .role-admin {
        background: #F1F5F9;
        color: #475569;
        border-color: #E2E8F0;
    }

    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 800;
    }

    .status-active {
        background: #ECFDF5;
        color: #10B981;
    }

    .status-inactive {
        background: #FEF2F2;
        color: #EF4444;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const rows = document.querySelectorAll('#result_list tbody tr');
        rows.forEach(row => {
            const cells = row.querySelectorAll('td');

            // Avatar and Username
            const userCell = row.querySelector('.field-username') || cells[1];
            if (userCell) {
                const name = userCell.innerText.trim();
                const initial = name.charAt(0).toUpperCase();
                userCell.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 36px; height: 36px; border-radius: 50%; background: #F1F5F9; display: flex; align-items: center; justify-content: center; font-weight: 800; color: #64748B;">${initial}</div>
                        <div style="font-weight: 700; color: #1E293B;">${name}</div>
                    </div>
                `;
            }

            // Roles
            const roleCell = row.querySelector('.field-role');
            if (roleCell) {
                const role = roleCell.innerText.trim();
                const roleClass = role.toLowerCase() === 'owner' ? 'role-owner' : (role.toLowerCase() === 'tenant' ? 'role-tenant' : 'role-admin');
                roleCell.innerHTML = `<span class="role-badge ${roleClass}">${role}</span>`;
            }

            // Status
            const activeCell = row.querySelector('.field-is_active');
            if (activeCell) {
                const img = activeCell.querySelector('img');
                const isActive = img ? img.getAttribute('alt') === 'True' : activeCell.innerText.trim() === 'True';
                activeCell.innerHTML = isActive
                    ? `<span class="status-badge status-active">Active</span>`
                    : `<span class="status-badge status-inactive">Inactive</span>`;
            }
        });
    });
</script>